<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Volt-Guard | Separate GC Sweep UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .app-icon { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; position: relative; }
        .is-running { border: 2px solid #22d3ee; box-shadow: 0 0 15px rgba(34, 211, 238, 0.4); background: rgba(34, 211, 238, 0.1); }
        .is-swapped { opacity: 0.3; filter: grayscale(1); }
        .gc-highlight { animation: sweep-red 2s infinite; border: 1px solid #ef4444; }
        @keyframes sweep-red { 0%, 100% { background: rgba(239, 68, 68, 0.1); } 50% { background: rgba(239, 68, 68, 0.4); } }
        .loading-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; border-radius: 1.5rem; color: #22d3ee; font-size: 8px; font-weight: bold; }
    </style>
</head>
<body class="h-screen flex items-center justify-center p-4">

    <div id="shutdown" class="hidden fixed inset-0 bg-black flex flex-col items-center justify-center z-50 text-center">
        <h1 class="text-6xl mb-4">ðŸª«</h1>
        <p class="text-red-500 font-bold text-2xl uppercase tracking-widest">Battery 0%: System Halted</p>
        <button onclick="charge()" class="mt-8 bg-green-600 px-10 py-4 rounded-full font-bold">RECHARGE NOW</button>
    </div>

    <div class="w-full max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-4 h-[90vh]">
        
        <div class="lg:col-span-3 glass rounded-[3rem] p-6 border-4 border-slate-800 flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <span id="bat-val" class="text-xs font-bold text-green-400">100%</span>
                <div class="w-10 h-5 border border-slate-500 rounded-sm p-0.5">
                    <div id="bat-fill" class="h-full bg-green-500 transition-all duration-1000" style="width: 100%"></div>
                </div>
            </div>
            <div id="drawer" class="grid grid-cols-2 gap-3 flex-grow overflow-y-auto"></div>
            <div class="mt-4 space-y-2">
                <div class="grid grid-cols-3 gap-1">
                    <button onclick="setMode('PERFORMANCE')" id="m-perf" class="text-[7px] p-2 rounded bg-slate-700 font-bold uppercase">Perf</button>
                    <button onclick="setMode('NORMAL')" id="m-norm" class="text-[7px] p-2 rounded bg-cyan-600 font-bold uppercase">Norm</button>
                    <button onclick="setMode('SAVER')" id="m-save" class="text-[7px] p-2 rounded bg-slate-700 font-bold uppercase">Save</button>
                </div>
                <button id="auto-btn" onclick="toggleAuto()" class="w-full bg-indigo-600 py-2 rounded-xl font-bold text-[9px] uppercase">Auto-Pilot: OFF</button>
            </div>
        </div>

        <div class="lg:col-span-6 glass p-4 rounded-3xl flex flex-col overflow-hidden border border-slate-800">
            <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4 flex justify-between">
                <span>Process Control Block (PCB)</span>
                <span id="mode-badge" class="text-cyan-400">MODE: NORMAL</span>
            </h3>
            <div class="flex-grow overflow-y-auto">
                <table class="w-full text-left text-[10px]">
                    <thead class="text-slate-500 border-b border-slate-800 sticky top-0 bg-[#020617] z-10">
                        <tr>
                            <th>PID</th><th>APP</th><th>TIER</th><th>CPU BURST</th><th>ACTIVITY %</th>
                        </tr>
                    </thead>
                    <tbody id="pcb-rows"></tbody>
                </table>
            </div>
        </div>

        <div class="lg:col-span-3 flex flex-col gap-4">
            <div class="glass p-5 rounded-3xl border border-red-900/50 flex-grow flex flex-col overflow-hidden">
                <h3 class="text-[10px] font-black text-red-500 uppercase mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                    Heuristic GC Sweep Buffer
                </h3>
                <div id="gc-sweep-box" class="flex-grow space-y-2 overflow-y-auto text-[10px]">
                    <div class="text-slate-500 italic text-center py-10">No trash identified...</div>
                </div>
                <div class="mt-4 pt-4 border-t border-red-900/30">
                    <p class="text-[8px] text-slate-400 uppercase font-bold mb-1">GC Status</p>
                    <div id="gc-action-text" class="text-[10px] font-mono text-green-400 font-bold">MONITORING...</div>
                </div>
            </div>

            <div class="glass h-32 p-4 rounded-3xl border border-slate-800 overflow-hidden">
                <p class="text-[8px] text-slate-500 font-bold uppercase mb-2">Kernel Logs</p>
                <div id="logs" class="font-mono text-[9px] text-slate-400 h-16 overflow-y-auto space-y-1"></div>
            </div>
        </div>
    </div>

    <script>
        let battery = 100, sysTime = 0, isAuto = false, isCharging = false, mode = 'NORMAL';
        let apps = [
            { id: '401', name: "Insta", icon: "ðŸ“¸", uptime: 0, wait: 0, status: "Ready", loc: "RAM" },
            { id: '402', name: "Video", icon: "ðŸŽ¬", uptime: 0, wait: 0, status: "Ready", loc: "RAM" },
            { id: '403', name: "Chats", icon: "ðŸ’¬", uptime: 0, wait: 0, status: "Ready", loc: "RAM" },
            { id: '404', name: "Maps", icon: "ðŸ“", uptime: 0, wait: 0, status: "Ready", loc: "RAM" },
            { id: '405', name: "Music", icon: "ðŸŽµ", uptime: 0, wait: 0, status: "Ready", loc: "RAM" },
            { id: '406', name: "Notes", icon: "ðŸ“", uptime: 0, wait: 0, status: "Ready", loc: "RAM" }
        ];

        function setMode(m) {
            mode = m;
            ['m-perf', 'm-norm', 'm-save'].forEach(id => document.getElementById(id).className = "text-[7px] p-2 rounded bg-slate-700 font-bold uppercase");
            let activeId = m === 'PERFORMANCE' ? 'm-perf' : m === 'NORMAL' ? 'm-norm' : 'm-save';
            document.getElementById(activeId).classList.add('bg-cyan-600');
            document.getElementById('mode-badge').innerText = `MODE: ${m}`;
            log(`[POLICY] Switch to ${m} Mode.`);
            render();
        }

        function clickApp(id) {
            let app = apps.find(a => a.id === id);
            if(app.loc === "Disk") {
                app.loading = true; render();
                setTimeout(() => { app.loc = "RAM"; app.loading = false; app.wait = 0; activate(app); }, 1500);
            } else { activate(app); }
        }

        function activate(app) {
            apps.forEach(a => { if(a.status === "Running") a.status = "Ready"; });
            app.status = "Running"; app.wait = 0; if(!isAuto) step(3); render();
        }

        function toggleAuto() { if(battery <= 0) return; isAuto = !isAuto; document.getElementById('auto-btn').innerText = isAuto ? "STOP KERNEL" : "START AUTO-PILOT"; if(isAuto) tick(); }

        function charge() { isCharging = true; battery = Math.min(100, battery + 30); document.getElementById('shutdown').classList.add('hidden'); setTimeout(() => { isCharging = false; render(); }, 1000); }

        function tick() { if(!isAuto || battery <= 0) { check(); return; } step(3); if(Math.random() > 0.5) { let ram = apps.filter(a => a.loc === "RAM"); if(ram.length) activate(ram[Math.floor(Math.random()*ram.length)]); } setTimeout(tick, 2000); }

        function step(s) {
            sysTime += s; if(!isCharging) battery = Math.max(0, battery - 4);
            apps.forEach(a => { if(a.status === "Running") a.uptime += s; else a.wait += s; });

            let gcBox = document.getElementById('gc-sweep-box');
            let sweepHtml = "";
            let gcStatus = document.getElementById('gc-action-text');

            let shouldGC = (mode === 'SAVER') || (mode === 'NORMAL' && battery < 20);
            
            if(shouldGC && mode !== 'PERFORMANCE') {
                gcStatus.innerText = "SWEEPING TRASH...";
                gcStatus.className = "text-[10px] font-mono text-red-500 font-bold animate-pulse";
                
                apps.forEach(a => {
                    let r = a.uptime / sysTime;
                    if(r < 0.20 && a.loc === "RAM" && a.status !== "Running" && a.wait > 10) {
                        sweepHtml += `<div class="p-2 border border-red-500/30 rounded bg-red-500/10 flex justify-between items-center">
                            <span>${a.name} (PID:${a.id})</span><span class="text-[8px] font-bold text-red-400">TRASH FLAG</span>
                        </div>`;
                        a.loc = "Disk"; a.status = "Ready"; log(`[GC] Collected ${a.name} (Usage < 20%)`);
                    }
                });
            } else {
                gcStatus.innerText = "MONITORING SYSTEM...";
                gcStatus.className = "text-[10px] font-mono text-green-400 font-bold";
            }

            if(sweepHtml) gcBox.innerHTML = sweepHtml;
            else if(!gcBox.innerHTML.includes('border')) gcBox.innerHTML = '<div class="text-slate-500 italic text-center py-10">No trash identified...</div>';
            
            render(); check();
        }

        function check() { if(battery <= 0) { battery = 0; isAuto = false; document.getElementById('shutdown').classList.remove('hidden'); render(); } }

        function render() {
            const drw = document.getElementById('drawer'); drw.innerHTML = '';
            apps.forEach(a => {
                const div = document.createElement('div');
                div.className = `app-icon glass p-3 rounded-2xl flex flex-col items-center gap-1 ${a.status === 'Running' ? 'is-running' : a.loc === 'Disk' ? 'is-swapped' : ''}`;
                div.onclick = () => clickApp(a.id);
                div.innerHTML = `<span class="text-2xl">${a.icon}</span><span class="text-[8px] font-bold uppercase">${a.name}</span>
                    ${a.loading ? '<div class="loading-overlay italic">PAGE-IN</div>' : ''}`;
                drw.appendChild(div);
            });

            const rows = document.getElementById('pcb-rows'); rows.innerHTML = '';
            apps.forEach(a => {
                let r = Math.round((a.uptime / sysTime) * 100) || 0;
                const tr = document.createElement('tr');
                tr.className = `border-b border-slate-800/50 ${a.status === 'Running' ? 'bg-cyan-500/10' : (r < 20 && a.loc === 'RAM' && sysTime > 5) ? 'gc-highlight' : ''}`;
                tr.innerHTML = `<td class="py-2 text-slate-500">${a.id}</td><td class="font-bold">${a.name}</td>
                    <td><span class="px-2 py-0.5 rounded ${a.loc === 'RAM' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-red-500/20 text-red-500'} font-bold">${a.loc}</span></td>
                    <td>${a.uptime}s</td><td class="${r < 20 ? 'text-red-400' : 'text-green-400'} font-bold">${r}%</td>`;
                rows.appendChild(tr);
            });
            document.getElementById('bat-val').innerText = battery + "%";
            document.getElementById('bat-fill').style.width = battery + "%";
            document.getElementById('bat-fill').className = `h-full ${battery < 20 ? 'bg-red-500' : 'bg-green-500'}`;
        }

        function log(m) { const l = document.getElementById('logs'); l.innerHTML = `<div>> ${m}</div>` + l.innerHTML; }
        render();
    </script>
</body>
</html>
